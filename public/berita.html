<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Berita terbaru Pondok Pesantren Al Ikhsan Beji" />
    <title>Berita – Pondok Pesantren Al Ikhsan Beji</title>

    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />
    <link rel="stylesheet" href="/assets/css/tailwind.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <script src="/i18n.js" defer></script>
    <script src="/assets/js/navbar.js" defer></script>

    <style>
      body {
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI',
          sans-serif;
      }
      .prose-content h1,
      .prose-content h2,
      .prose-content h3,
      .prose-content h4 {
        margin-top: 1.25em;
        margin-bottom: 0.75em;
        font-weight: 600;
        color: #0f172a;
      }
      .prose-content p {
        margin-bottom: 1rem;
        line-height: 1.75;
        color: #1f2937;
      }
      .prose-content ul {
        margin-bottom: 1rem;
        padding-left: 1.5rem;
        list-style: disc;
        color: #1f2937;
      }
      .prose-content img {
        max-width: 100%;
        border-radius: 1rem;
        margin: 1.5rem 0;
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col bg-gray-50 text-gray-800">
    <header class="bg-white shadow-sm">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
        <a href="/index.html" class="flex items-center gap-3">
          <img src="/logo-bimi.svg" alt="Logo Al Ikhsan" class="h-12 w-auto" />
          <div>
            <p class="text-sm text-gray-500 uppercase tracking-wide">Pondok Pesantren</p>
            <p class="text-lg font-semibold text-gray-900">Al Ikhsan Beji</p>
          </div>
        </a>
        <nav class="hidden md:flex items-center gap-6 text-sm font-medium text-gray-600">
          <a href="/index.html" class="hover:text-emerald-600 transition">Beranda</a>
          <a href="/alur-pendaftaran.html" class="hover:text-emerald-600 transition">Alur</a>
          <a href="/biaya.html" class="hover:text-emerald-600 transition">Biaya</a>
          <a href="/kontak.html" class="hover:text-emerald-600 transition">Kontak</a>
        </nav>
        <a
          href="/daftar.html"
          class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-600 text-white text-sm font-semibold shadow"
        >
          <i class="bi bi-pencil-square"></i> Daftar Sekarang
        </a>
      </div>
    </header>

    <main class="flex-1 py-10">
      <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <nav class="text-sm text-gray-500 mb-6">
          <a href="/index.html" class="hover:text-emerald-600">Beranda</a>
          <span class="mx-2">/</span>
          <span>Berita</span>
        </nav>

        <section
          id="beritaDetail"
          class="bg-white rounded-3xl shadow-xl border border-gray-100 p-6 sm:p-10 mb-10 min-h-[280px] flex flex-col gap-6"
        >
          <div class="animate-pulse space-y-4">
            <div class="h-6 bg-gray-200 rounded w-32"></div>
            <div class="h-10 bg-gray-200 rounded"></div>
            <div class="h-4 bg-gray-200 rounded"></div>
            <div class="h-4 bg-gray-200 rounded w-2/3"></div>
          </div>
        </section>

        <section class="mb-8">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold text-gray-900">Berita Lainnya</h2>
            <a href="/index.html#berita" class="text-emerald-600 font-semibold text-sm inline-flex items-center">
              Kembali ke Beranda <i class="bi bi-arrow-right-short text-lg"></i>
            </a>
          </div>
          <div id="beritaLainnya" class="grid gap-4">
            <div class="h-28 bg-gray-200 rounded-2xl animate-pulse"></div>
            <div class="h-28 bg-gray-200 rounded-2xl animate-pulse"></div>
            <div class="h-28 bg-gray-200 rounded-2xl animate-pulse"></div>
          </div>
        </section>
      </div>
    </main>

    <footer class="bg-white border-t border-gray-200 py-6">
      <div class="max-w-6xl mx-auto px-4 text-center text-sm text-gray-500">
        © 2025/2026 Pondok Pesantren Al Ikhsan Beji. All rights reserved.
      </div>
    </footer>

    <script>
      const DETAIL_CONTAINER = document.getElementById("beritaDetail");
      const LIST_CONTAINER = document.getElementById("beritaLainnya");
      const params = new URLSearchParams(window.location.search);
      const artikelId = params.get("id");

      const escapeHtml = (value = "") =>
        String(value).replace(/[&<>"']/g, (char) => {
          switch (char) {
            case "&":
              return "&amp;";
            case "<":
              return "&lt;";
            case ">":
              return "&gt;";
            case '"':
              return "&quot;";
            case "'":
              return "&#39;";
            default:
              return char;
          }
        });

      const formatDate = (dateString) => {
        try {
          return new Date(dateString).toLocaleDateString("id-ID", {
            day: "numeric",
            month: "long",
            year: "numeric",
          });
        } catch (error) {
          return dateString || "-";
        }
      };

      const renderDetail = (article) => {
        if (!article) {
          DETAIL_CONTAINER.innerHTML = `
            <div class="text-center py-16">
              <p class="text-lg font-semibold text-gray-600 mb-3">Berita tidak ditemukan</p>
              <p class="text-gray-500 mb-6">Coba kembali ke beranda atau pilih berita lain.</p>
              <a href="/index.html#berita" class="inline-flex items-center px-4 py-2 rounded-full bg-emerald-600 text-white font-semibold shadow">
                Kembali ke Beranda
              </a>
            </div>
          `;
          return;
        }

        const content = article.content_id || article.content_en || "";
        const rawImage = article.image_url || "";
        const imageUrl =
          rawImage.trim() ||
          "https://images.unsplash.com/photo-1524368535928-5b5e00ddc76b?w=1200&h=700&fit=crop";

        DETAIL_CONTAINER.innerHTML = `
          <article>
            <div class="flex items-center gap-3 text-sm text-gray-500 mb-3">
              <i class="bi bi-calendar-event text-emerald-600"></i>
              <span>${formatDate(article.published_date || article.created_at)}</span>
            </div>
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-6">${escapeHtml(
              article.title_id || article.title_en || ""
            )}</h1>
            <img
              src="${escapeHtml(imageUrl)}"
              alt="${escapeHtml(article.title_id || article.title_en || "")}"
              class="w-full h-auto rounded-2xl shadow-lg object-cover mb-8"
              onerror="this.src='https://images.unsplash.com/photo-1524368535928-5b5e00ddc76b?w=1200&h=700&fit=crop'"
            />
            <div class="prose-content">
              ${content || "<p>Konten berita akan tersedia segera.</p>"}
            </div>
          </article>
        `;
      };

      const renderOtherNews = (list) => {
        if (!list.length) {
          LIST_CONTAINER.innerHTML = `
            <div class="text-center text-gray-500 py-6">
              Belum ada berita lain.
            </div>
          `;
          return;
        }

        LIST_CONTAINER.innerHTML = list
          .map((item) => {
            const title = item.title_id || item.title_en || "";
            const excerpt = (item.content_id || item.content_en || "")
              .replace(/<[^>]+>/g, "")
              .slice(0, 120);
            const image = item.image_url
              ? escapeHtml(item.image_url)
              : "https://images.unsplash.com/photo-1524368535928-5b5e00ddc76b?w=400&h=300&fit=crop";
            return `
              <a href="/berita.html?id=${encodeURIComponent(
                item.id
              )}" class="flex gap-4 bg-white border border-gray-100 rounded-2xl p-4 shadow hover:shadow-lg transition">
                <div class="w-24 h-20 rounded-xl overflow-hidden flex-shrink-0">
                  <img src="${image}" alt="${escapeHtml(
              title
            )}" class="w-full h-full object-cover" />
                </div>
                <div class="flex-1">
                  <div class="text-xs text-gray-500 flex items-center gap-2 mb-1">
                    <i class="bi bi-calendar text-emerald-600"></i>
                    <span>${formatDate(item.published_date || item.created_at)}</span>
                  </div>
                  <h3 class="text-base font-semibold text-gray-900 mb-1">${escapeHtml(
                    title
                  )}</h3>
                  <p class="text-sm text-gray-500 line-clamp-2">${escapeHtml(excerpt)}...</p>
                </div>
              </a>
            `;
          })
          .join("");
      };

      async function initDetail() {
        try {
          const response = await fetch("/api/berita_items?published_only=true");
          const result = await response.json();
          if (!result.ok || !Array.isArray(result.data) || !result.data.length) {
            renderDetail(null);
            renderOtherNews([]);
            return;
          }

          const target = artikelId
            ? result.data.find((item) => String(item.id) === String(artikelId))
            : result.data[0];

          renderDetail(target);

          const otherList = result.data
            .filter((item) => !target || item.id !== target.id)
            .slice(0, 6);
          renderOtherNews(otherList);
        } catch (error) {
          console.error("[BERITA_DETAIL] Error:", error);
          renderDetail(null);
          renderOtherNews([]);
        }
      }

      initDetail();
    </script>
  </body>
</html>
